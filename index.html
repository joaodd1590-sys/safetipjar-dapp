<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ARC ACTIVITY</title>
  <link rel="icon" type="image/png" href="https://i.imgur.com/0ZK0l9g.png"/>
  <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="wrap">

    <!-- LEFT PANEL -->
    <div class="panel">
      <div class="title">ARC ACTIVITY TRACKER</div>
      <div class="subtitle">Community scanner â€” shows live activity on Arc Testnet</div>

      <input id="addr" class="address" placeholder="Paste Arc Testnet wallet (0x...)">
      <button id="runScan" class="scan">Run Scan</button>

      <div class="summary" id="summary" style="display:none;">
        <div class="sum-box">
          <div class="sum-label">Total</div>
          <div id="sTotal" class="sum-value">0</div>
        </div>
        <div class="sum-box">
          <div class="sum-label">First Tx</div>
          <div id="sFirst" class="sum-value">--</div>
        </div>
        <div class="sum-box">
          <div class="sum-label">Last Tx</div>
          <div id="sLast" class="sum-value">--</div>
        </div>
        <div class="sum-box">
          <div class="sum-label">Status</div>
          <div id="sStatus" class="sum-value">--</div>
        </div>
      </div>

      <div id="terminal" class="terminal">
        Run a scan to show the latest transactions (Arc Testnet).
      </div>
    </div>

    <!-- RIGHT PANEL -->
    <div class="panel snapshot-panel">

      <div class="snapshot-title">Wallet Snapshot</div>

      <div class="snap-row"><span>Wallet</span><span id="wAddr">--</span></div>
      <div class="snap-row"><span>Network</span><span>Arc Testnet</span></div>
      <div class="snap-row"><span>Tx Count</span><span id="wCount">0</span></div>
      <div class="snap-row"><span>Active</span><span id="wActive">No</span></div>

      <div style="margin-top:14px;display:flex;gap:10px;">
        <button class="btn" id="copyLink">Copy Profile Link</button>
        <button class="btn" id="openArc">Open in ArcScan</button>
      </div>

      <div class="coming">
        <div class="coming-title">ðŸš§ Leaderboard Coming Soon</div>
        <div class="coming-text">
          Em breve: ranking das <b>50 wallets mais ativas</b> da Arc Testnet.
        </div>
      </div>

    </div>

  </div>

<script>
const $ = s => document.querySelector(s);

const term = $("#terminal");
const summary = $("#summary");
const wAddr = $("#wAddr"), wCount = $("#wCount"), wActive = $("#wActive");
const sTotal = $("#sTotal"), sFirst = $("#sFirst"), sLast = $("#sLast"), sStatus = $("#sStatus");

async function runScan(){
  const wallet = $("#addr").value.trim();
  if(!wallet.startsWith("0x") || wallet.length < 40){
    term.innerHTML = "Invalid wallet address.";
    return;
  }

  term.innerHTML = "Scanning...";
  summary.style.display = "none";

  const resp = await fetch(`/api/activity?address=${wallet}`);
  const data = await resp.json();

  const txs = data.transactions || [];

  wAddr.textContent = wallet;
  wCount.textContent = txs.length;
  wActive.textContent = txs.length > 0 ? "Yes":"No";

  sTotal.textContent = txs.length;
  sFirst.textContent = txs.length ? txs[txs.length-1].time : "--";
  sLast.textContent = txs.length ? txs[0].time : "--";
  sStatus.textContent = txs.length ? "ACTIVE":"NO ACTIVITY";

  summary.style.display = "flex";

  if(!txs.length){
    term.innerHTML = "No transactions found.";
    return;
  }

  term.innerHTML = "";
  txs.forEach(tx => {
    const direction = tx.from.toLowerCase() === wallet.toLowerCase() ? "OUT":"IN";

    term.innerHTML += `
      <div class="tx">
        <div>
          <div class="hash">${tx.hash}</div>
          <div class="meta">${tx.from} â†’ ${tx.to} â€¢ ${tx.value} â€¢ ${tx.time}</div>
        </div>
        <div class="actions">
          <span class="${direction === "IN" ? "badge-in":"badge-out"}">${direction}</span>
          <button class="btn" onclick="navigator.clipboard.writeText('${tx.hash}')">Copy</button>
          <button class="btn" onclick="window.open('${tx.link}','_blank')">Explorer</button>
        </div>
      </div>
    `;
  });
}

$("#runScan").onclick = runScan;

$("#copyLink").onclick = () => {
  const w = $("#addr").value.trim();
  if(!w) return;
  navigator.clipboard.writeText(`${location.origin}/?addr=${w}`);
  alert("Profile link copied!");
};

$("#openArc").onclick = () => {
  const w = $("#addr").value.trim();
  if(!w) return;
  window.open(`https://testnet.arcscan.app/address/${w}`, "_blank");
};

// Auto-load '?addr='
const urlAddr = new URLSearchParams(location.search).get("addr");
if(urlAddr){
  $("#addr").value = urlAddr;
  runScan();
}
</script>
</body>
</html>
