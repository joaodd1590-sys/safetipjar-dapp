<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SafeTipJar — ARC Testnet (Neon)</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.1/dist/ethers.min.js"></script>
  <style>
    :root{
      --bg:#04040a; --panel:#0b0b12; --accent:#7c3aed; --accent2:#00d0ff; --glass: rgba(255,255,255,0.03);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:
      radial-gradient(1200px 600px at 10% 10%, rgba(124,58,237,0.06), transparent 8%),
      radial-gradient(1000px 500px at 90% 90%, rgba(0,208,255,0.03), transparent 10%),
      var(--bg); color:#e6eef8; -webkit-font-smoothing:antialiased;}
    .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px}
    .card{width:100%;max-width:920px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); border:1px solid rgba(255,255,255,0.04); border-radius:18px; padding:28px; box-shadow: 0 10px 40px rgba(2,6,23,0.7);}    
    .header{display:flex;gap:18px;align-items:center}
    .logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2)); display:flex;align-items:center;justify-content:center;font-weight:700;color:#001}
    h1{margin:0;font-size:1.45rem;letter-spacing:0.6px}
    p.sub{margin:6px 0 20px;color:#9fb3cf;font-size:0.95rem}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:20px}
    .panel{background:var(--panel);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.02)}
    label{display:block;font-size:0.85rem;color:#9fb3cf;margin-bottom:6px}
    input[type="number"], input[type="text"], textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-size:0.95rem;outline:none}
    .row{display:flex;gap:8px;align-items:center}
    .btn{cursor:pointer;border:0;padding:10px 14px;border-radius:10px;font-weight:600}
    .btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent2)); color:#021026; box-shadow: 0 6px 30px rgba(124,58,237,0.12);}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:#9fb3cf}
    .muted{color:#9fb3cf;font-size:0.9rem}
    .small{font-size:0.85rem;color:#8da2bf}
    .tx{font-family:monospace;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;word-break:break-all}
    .status{margin-top:10px;padding:12px;border-radius:8px;background:rgba(0,0,0,0.25);color:#dff7ff}
    .balance{font-weight:700;font-size:1.3rem;color:var(--accent2)}
    .info-badge{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.02);color:#bfeeff;font-size:0.8rem}
    .footer-row{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-top:14px}
    a.link{color:var(--accent2);text-decoration:none}
    @media (max-width:880px){ .grid{grid-template-columns:1fr;} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="header">
        <div class="logo">ARC</div>
        <div>
          <h1>SafeTipJar — Neon DApp (EN)</h1>
          <p class="sub">Send USDC tips to the SafeTipJar on Arc Testnet. Connect wallet, approve USDC, and send a tip — all in the browser.</p>
        </div>
      </div>

      <div class="grid" style="margin-top:18px">
        <!-- MAIN -->
        <div class="panel">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="muted">Contract</div>
              <div class="small tx" id="contractAddr">0x9f46FaE692A2F7A97b352bc788865E016164138f</div>
            </div>
            <div style="text-align:right">
              <div class="muted">Network</div>
              <div class="info-badge">Arc Testnet (5042002)</div>
            </div>
          </div>

          <hr style="margin:14px 0;border:none;border-top:1px solid rgba(255,255,255,0.02)">

          <div>
            <label>Connect Wallet</label>
            <div class="row" style="margin-bottom:12px">
              <button id="connectBtn" class="btn btn-primary">Connect MetaMask</button>
              <button id="switchBtn" class="btn btn-ghost">Add Network</button>
            </div>

            <div class="small muted">Account: <span id="acct">—</span></div>
          </div>

          <hr style="margin:14px 0;border:none;border-top:1px solid rgba(255,255,255,0.02)">

          <div>
            <label>Amount (USDC)</label>
            <input id="amount" type="number" placeholder="e.g. 1.25" step="0.000001" min="0" />
            <div style="margin-top:8px" class="row">
              <button id="approveBtn" class="btn btn-primary">Approve USDC</button>
              <button id="tipBtn" class="btn btn-primary" style="background:linear-gradient(90deg,#00d0ff,#7c3aed)">Send Tip</button>
              <button id="refreshBtn" class="btn btn-ghost">Refresh</button>
            </div>

            <div id="status" class="status" style="display:none"></div>
          </div>

          <div style="margin-top:14px">
            <div class="small muted">Last transaction</div>
            <div id="lastTx" class="tx">—</div>
          </div>

          <footer>
            <div class="footer-row">
              <div class="small muted">USDC token: <span id="usdcAddr">0x1c7D4B196Cb0C7B01d743Fbc6116a902379C7238</span></div>
              <div class="small muted">Decimals: 6</div>
            </div>
          </footer>
        </div>

        <!-- RIGHT HERO -->
        <div class="panel" style="text-align:center">
          <div class="muted">Owner balance (USDC)</div>
          <div class="balance" id="ownerBalance">—</div>

          <div style="margin-top:12px;text-align:left">
            <div class="muted">How it works</div>
            <ol class="small" style="padding-left:18px">
              <li>Connect MetaMask to Arc Testnet.</li>
              <li>Approve USDC for the contract.</li>
              <li>Click <strong>Send Tip</strong> — a real testnet transaction will be sent.</li>
            </ol>
          </div>

          <div style="margin-top:12px">
            <div class="muted">Prove authorship</div>
            <div class="small" style="margin-top:8px">Include Remix deploy screenshots, the contract address and this dApp link in your Creator submission.</div>

            <div style="margin-top:12px">
              <button id="copyBtn" class="btn btn-ghost">Copy Creator Message</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
// Configuration
const TIPJAR_ADDRESS = '0x9f46FaE692A2F7A97b352bc788865E016164138f';
const USDC_ADDRESS = '0x1c7D4B196Cb0C7B01d743Fbc6116a902379C7238';
const RPC_URL = 'https://rpc.testnet.arc.network';
const CHAIN_ID = 5042002;
const EXPLORER_TX = (tx) => `https://explorer.arc.network/tx/${tx}`;

// ABIs (minimal)
const TIPJAR_ABI = [
  { 'inputs':[{'internalType':'uint256','name':'amount','type':'uint256'}], 'name':'tip', 'outputs':[], 'stateMutability':'nonpayable', 'type':'function' },
  { 'inputs':[], 'name':'balance', 'outputs':[{'internalType':'uint256','name':'','type':'uint256'}], 'stateMutability':'view', 'type':'function' }
];
const USDC_ABI = [
  { 'name':'approve','type':'function','inputs':[{'name':'spender','type':'address'},{'name':'value','type':'uint256'}],'outputs':[{'name':'','type':'bool'}]},
  { 'name':'balanceOf','type':'function','inputs':[{'name':'owner','type':'address'}],'outputs':[{'name':'','type':'uint256'}],'stateMutability':'view'}
];

let provider, signer, tipJar, usdc;
const acctEl = document.getElementById('acct');
const statusEl = document.getElementById('status');
const lastTxEl = document.getElementById('lastTx');
const ownerBalanceEl = document.getElementById('ownerBalance');

function showStatus(text, show=true){ statusEl.style.display = show ? 'block' : 'none'; statusEl.innerText = text; }

function formatUSDCBigint(bn){ try{ const v = BigInt(bn); const int = v / 1000000n; const frac = v % 1000000n; const fracStr = String(frac).padStart(6,'0').replace(/0+$/,'') || '0'; return int.toString() + '.' + fracStr; } catch(e){ return '0'; } }

async function addArcNetwork(){
  if(!window.ethereum) throw new Error('MetaMask not found');
  await window.ethereum.request({ method: 'wallet_addEthereumChain', params: [{
    chainId: '0x' + CHAIN_ID.toString(16),
    chainName: 'Arc Testnet',
    rpcUrls: [RPC_URL],
    nativeCurrency: { name: 'ARC', symbol: 'ARC', decimals: 18 }
  }] });
}

async function connect(){
  if(!window.ethereum) { alert('MetaMask not detected'); return; }
  provider = new ethers.BrowserProvider(window.ethereum, 'any');
  try{
    await provider.send('eth_requestAccounts', []);
  } catch(e){ showStatus('Connection request rejected'); return; }
  signer = await provider.getSigner();
  const addr = await signer.getAddress();
  acctEl.innerText = addr;
  tipJar = new ethers.Contract(TIPJAR_ADDRESS, TIPJAR_ABI, signer);
  usdc = new ethers.Contract(USDC_ADDRESS, USDC_ABI, signer);
  showStatus('Wallet connected: ' + addr);
  await refreshBalances();
}

async function parseUSDC(amountStr){
  // ethers v6 exposes utils under ethers.utils
  try{
    return ethers.utils.parseUnits(String(amountStr), 6);
  } catch(e){
    // fallback manual BigInt conversion
    const s = String(amountStr);
    if(!s.includes('.')) return BigInt(s) * 1000000n;
    const [i,f] = s.split('.');
    const frac = (f + '000000').slice(0,6);
    return BigInt(i) * 1000000n + BigInt(frac);
  }
}

async function approveUSDC(){
  if(!usdc) return showStatus('Connect wallet first');
  const amount = document.getElementById('amount').value;
  if(!amount || Number(amount) <= 0) return showStatus('Enter a valid amount');
  const parsed = await parseUSDC(amount);
  try{
    showStatus('Sending approve transaction...');
    const tx = await usdc.approve(TIPJAR_ADDRESS, parsed);
    lastTxEl.innerText = tx.hash;
    showStatus('Approve sent: ' + tx.hash + '\nWaiting for confirmation...');
    await tx.wait();
    showStatus('Approve confirmed. You can now send the tip.');
  }catch(e){ showStatus('Approve error: ' + (e?.message||e)); }
}

async function sendTip(){
  if(!tipJar) return showStatus('Connect wallet first');
  const amount = document.getElementById('amount').value;
  if(!amount || Number(amount) <= 0) return showStatus('Enter a valid amount');
  const parsed = await parseUSDC(amount);
  try{
    showStatus('Sending tip...');
    const tx = await tipJar.tip(parsed);
    lastTxEl.innerText = tx.hash;
    showStatus('Tip sent: ' + tx.hash + '\nWaiting for confirmation...');
    await tx.wait();
    showStatus('Tip confirmed! Tx: ' + tx.hash + '\nExplorer: ' + EXPLORER_TX(tx.hash));
    await refreshBalances();
  }catch(e){ showStatus('Tip error: ' + (e?.message||e)); }
}

async function refreshBalances(){
  try{
    const readProvider = new ethers.JsonRpcProvider(RPC_URL);
    const readTip = new ethers.Contract(TIPJAR_ADDRESS, TIPJAR_ABI, readProvider);
    const bal = await readTip.balance();
    ownerBalanceEl.innerText = formatUSDCBigint(bal) + ' USDC';
  }catch(e){ console.warn(e); ownerBalanceEl.innerText = '—'; }
}

// UI wiring
document.getElementById('connectBtn').addEventListener('click', connect);
document.getElementById('switchBtn').addEventListener('click', async () => { try{ await addArcNetwork(); showStatus('Network added. Please switch in MetaMask.'); } catch(e){ showStatus('Add network error: ' + (e?.message||e)); } });
document.getElementById('approveBtn').addEventListener('click', approveUSDC);
document.getElementById('tipBtn').addEventListener('click', sendTip);
document.getElementById('refreshBtn').addEventListener('click', refreshBalances);
document.getElementById('copyBtn').addEventListener('click', async () => {
  const text = `SafeTipJar Creator submission\nContract: ${TIPJAR_ADDRESS}\nRPC: ${RPC_URL}\nDApp: ${window.location.href}\nI tested by sending a tip on Arc Testnet.`;
  await navigator.clipboard.writeText(text);
  alert('Copied to clipboard');
});

// init
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('contractAddr').innerText = TIPJAR_ADDRESS;
  document.getElementById('usdcAddr').innerText = USDC_ADDRESS;
  refreshBalances();
});
</script>
</body>
</html>
